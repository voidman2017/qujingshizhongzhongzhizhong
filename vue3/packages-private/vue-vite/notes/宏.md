https://juejin.cn/post/7410366806781231131

https://www.cnblogs.com/heavenYJJ/p/18021306

## 编译器宏

在 Vue 3 中，特别是在 `<script setup>` 语法糖中，提供了一些**编译器宏**（Compiler Macros），用于简化组件的定义和逻辑。这些宏不需要手动导入，由 Vue 编译器自动处理。以下是主要的宏及其用途：

---

### 1. **`defineProps`**

- **作用**: 声明组件的 props（支持 TypeScript 类型推导）。
- **示例**:

  ```vue
  <script setup>
  const props = defineProps({
    title: String,
    count: { type: Number, default: 0 }
  });

  // TypeScript 写法
  const props = defineProps<{
    title: string;
    count?: number
  }>();
  </script>
  ```

---

### 2. **`defineEmits`**

- **作用**: 声明组件触发的事件（支持类型检查）。
- **示例**:

  ```vue
  <script setup>
  const emit = defineEmits(['update:title', 'submit']);

  // TypeScript 写法
  const emit = defineEmits<{
    (e: 'update:title', value: string): void;
    (e: 'submit', data: FormData): void;
  }>();
  </script>
  ```

---

### 3. **`defineExpose`**

- **作用**: 暴露组件内部的属性或方法给父组件（通过模板 ref 访问）。
- **示例**:
  ```vue
  <script setup>
  const reset = () => {
    /* ... */
  }
  defineExpose({ reset })
  </script>
  ```

---

### 4. **`withDefaults`**

- **作用**: 配合 `defineProps` 的 TypeScript 类型声明，为 props 提供默认值。
- **示例**:

  ```vue
  <script setup lang="ts">
  interface Props {
    title?: string
    count?: number
  }

  const props = withDefaults(defineProps<Props>(), {
    title: 'Default Title',
    count: 0,
  })
  </script>
  ```

---

### 5. **`defineOptions`**

- **作用**: 在 `<script setup>` 中声明传统组件选项（如 `name`, `inheritAttrs` 等）。
- **示例**:
  ```vue
  <script setup>
  defineOptions({
    name: 'MyComponent',
    inheritAttrs: false,
  })
  </script>
  ```

---

### 6. **`defineSlots`**（TypeScript）

- **作用**: 声明插槽类型（用于类型检查插槽内容）。
- **示例**:
  ```vue
  <script setup lang="ts">
  defineSlots<{
    default: (props: { text: string }) => any
    header?: () => any
  }>()
  </script>
  ```

---

### 7. **`defineModel`**（实验性）

- **作用**: 简化 `v-model` 的双向绑定（需手动启用）。
- **配置** (`vite.config.js`):
  ```js
  export default defineConfig({
    plugins: [
      vue({
        script: { defineModel: true },
      }),
    ],
  })
  ```
- **示例**:
  ```vue
  <script setup>
  const modelValue = defineModel()
  // 相当于 props.modelValue 和 emit('update:modelValue')
  </script>
  ```

---

### 注意事项

1. **仅在 `<script setup>` 中有效**：这些宏由 Vue 编译器处理，只能在 `<script setup>` 中使用。
2. **无须手动导入**：这些宏会全局可用。
3. **类型支持**：TypeScript 用户可通过泛型参数获得更严格的类型检查。
4. **实验性功能**：如 `defineModel` 可能需明确启用。

通过合理使用这些宏，可以在保持简洁性的同时享受类型安全和增强的功能。
